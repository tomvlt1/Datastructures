<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Match-IE Collaborators</title>

  <!-- Stylesheets -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.5.0/nouislider.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.5.0/nouislider.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

  <script>
    window.onload = function () {
      // Fetch data from Flask and parse it for DataTables
      var collaborators_data = {{ data | tojson | safe }};
      console.log("Data sent to server:", collaborators_data);

      // DataTables configuration
      var table = $('#collaborators_table').DataTable({
        data: collaborators_data, // Ensure collaborators_data is an array of objects
        columns: [
          { data: 'First Name', title: 'First Name' },
          { data: 'Last Name', title: 'Last Name' },
          { data: 'Rating', title: 'Rating' },
          { data: 'Age', title: 'Age' },
          { data: 'DOB', title: 'Date of Birth' },
          { data: 'Nationality', title: 'Nationality' },
          { data: 'Country of Residence', title: 'Country of Residence' },
          { data: 'Degree', title: 'Degree' },
          { data: 'Graduation Year', title: 'Graduation Year' },
          { data: 'GPA', title: 'GPA' },
          { data: 'Availability', title: 'Availability (hours/week)' },
          { data: 'Topics of Interest', title: 'Topics of Interest' },
          { data: 'Email', title: 'Email' },
          { data: 'Description', title: 'Description' },
          { data: 'Additional Information', title: 'Additional Information' },
          { data: 'Sort Value', title: 'Sort Value' }
        ],
        paging: true,
        searching: true,
        ordering: true
      });

      // Dynamic Filtering
      $('#filter_form').submit(function (e) {
        e.preventDefault(); // Prevent default form submission
        var formData = $(this).serializeArray();
        var data = {};

        formData.forEach(function (field) {
          data[field.name] = field.value;
        });

        // AJAX Request
        $.ajax({
          url: '/collaborators',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify(data),
          success: function (response) {
            console.log("Parsed response:", response);
            table.clear();

            // Ensure response.data is an array of objects
            if (response && response.data) {
              table.rows.add(response.data); // response.data should be the array of records
              table.draw();
            } else {
              console.error("The response does not contain the expected data.");
            }
          },
          error: function (xhr, status, error) {
            console.error("Error fetching data:", error);
            console.log("Server response:", xhr.responseText);
          }
        });
      });

      // Initialize Sliders

      // Age Slider
      var ageSlider = document.getElementById('age_slider');
      noUiSlider.create(ageSlider, {
        start: [18, 99],
        connect: true,
        range: {
          min: 0,
          max: 100
        }
      });
      ageSlider.noUiSlider.on('update', function (values) {
        document.getElementById('min_age').value = values[0];
        document.getElementById('max_age').value = values[1];
      });

      // GPA Slider
      var gpaSlider = document.getElementById('gpa_slider');
      noUiSlider.create(gpaSlider, {
        start: [0.0, 10.0],
        connect: true,
        range: {
          min: 0.0,
          max: 10.0
        }
      });
      gpaSlider.noUiSlider.on('update', function (values) {
        document.getElementById('min_gpa').value = values[0];
        document.getElementById('max_gpa').value = values[1];
      });

      // Availability Slider
      var availabilitySlider = document.getElementById('availability_slider');
      noUiSlider.create(availabilitySlider, {
        start: [0, 40],
        connect: true,
        range: {
          min: 0,
          max: 60
        }
      });
      availabilitySlider.noUiSlider.on('update', function (values) {
        document.getElementById('min_hours').value = values[0];
        document.getElementById('max_hours').value = values[1];
      });
    };
  </script>

  <style>
    /* Remove global line-height */
    body,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    p,
    label,
    input,
    button {
      line-height: 1; /* Removes line spacing */
    }

    .container {
      display: flex;
    }

    .filters {
      width: 30%;
      padding-right: 20px;
    }

    .content {
      width: 70%;
    }

    /* Optional Enhancements */

    /* Footer Styling */
    footer {
      background-color: #f8f9fa;
      text-align: center;
      padding: 20px 0;
      position: fixed;
      width: 100%;
      bottom: 0;
    }

    /* Banner Styling */
    .banner {
      background-color: #e9ecef;
      padding: 40px 0;
      text-align: center;
    }

    /* Activity Section Styling */
    .activity-section {
      padding: 20px 0;
    }

    .activity-container {
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }

    .activity-column {
      flex: 1;
    }

    .activity-box {
      background-color: #ffffff;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .activity-box p {
      margin-bottom: 10px;
    }
  </style>

</head>

<body>

  <header>
    <div class="navbar">
      <h1 class="logo">Match-IE</h1>
      <nav>
        <a href="{{ url_for('home.home') }}">Home</a>
        <a href="{{ url_for('collaborators.collaborators') }}">Collaborators</a>
        <a href="#">Projects</a>
        <a href="{{ url_for('mentors.mentors') }}">Mentor</a>

        {% if session.get('IsLogged') == True %}
          <a href="{{ url_for('account.account_page') }}">Profile</a>
          <a href="{{ url_for('logout') }}">Logout</a>
        {% else %}
          <a href="{{ url_for('login.login_page') }}">Login</a>
        {% endif %}
      </nav>
    </div>
  </header>

  <main>
    <div class="container mt-5">
      <!-- Filters Sidebar -->
      <aside class="filters">
        <h2>Filters</h2>
        <form id="filter_form" method="post" action="/collaborators">
          <!-- Looking For -->
          <div class="mb-3">
            <label for="looking_for" class="form-label">Looking For:</label>
            <input type="text" id="looking_for" name="looking_for" class="form-control">
          </div>

          <!-- Looking For Degree -->
          <div class="mb-3">
            <label for="looking_for_degree" class="form-label">Looking For Degree:</label>
            <input type="text" id="looking_for_degree" name="looking_for_degree" class="form-control">
          </div>

          <!-- Age Range Slider -->
          <div class="mb-3">
            <label for="age_slider" class="form-label">Age Range:</label>
            <div id="age_slider" class="mb-3"></div>
            <input type="hidden" id="min_age" name="min_age">
            <input type="hidden" id="max_age" name="max_age">
          </div>

          <!-- GPA Range Slider -->
          <div class="mb-3">
            <label for="gpa_slider" class="form-label">GPA Range:</label>
            <div id="gpa_slider" class="mb-3"></div>
            <input type="hidden" id="min_gpa" name="min_gpa">
            <input type="hidden" id="max_gpa" name="max_gpa">
          </div>

          <!-- Availability Slider -->
          <div class="mb-3">
            <label for="availability_slider" class="form-label">Availability (Hours per Week):</label>
            <div id="availability_slider" class="mb-3"></div>
            <input type="hidden" id="min_hours" name="min_hours">
            <input type="hidden" id="max_hours" name="max_hours">
          </div>

          <!-- Nationality -->
          <div class="mb-3">
            <label for="nationality" class="form-label">Nationality:</label>
            <input type="text" id="nationality" name="nationality" class="form-control">
          </div>

          <!-- Country of Residence -->
          <div class="mb-3">
            <label for="country_of_residence" class="form-label">Country of Residence:</label>
            <input type="text" id="country_of_residence" name="country_of_residence" class="form-control">
          </div>

          <!-- Degree -->
          <div class="mb-3">
            <label for="degree" class="form-label">Degree:</label>
            <input type="text" id="degree" name="degree" class="form-control">
          </div>

          <!-- Graduation Year -->
          <div class="mb-3">
            <label for="graduation_year" class="form-label">Graduation Year:</label>
            <input type="text" id="graduation_year" name="graduation_year" class="form-control">
          </div>

          <!-- Submit Button -->
          <button type="submit" class="btn btn-primary">Apply</button>
        </form>

        <!-- Button to Clear Filters -->
        <button type="button" id="clean_filters" class="btn btn-warning mt-3" onclick="location.reload();">Clean Filters</button>
      </aside>

      <!-- Mentors Content -->
      <section class="content">
        <h2>Potential Mentors, Suggested</h2>
        <div class="table-responsive">
          <table id="mentors_table" class="table table-striped table-bordered">
            <!-- DataTables will populate this table with data -->
          </table>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <p>Contact Us: dreamteam@gmail.com</p>
  </footer>

</body>

</html>

